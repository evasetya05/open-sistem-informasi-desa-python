{% extends "navbar.html" %}

{% block title_block %}
    Staff Desa Dashboard
{% endblock title_block %}

{% block content %}
<div class="d-flex">
    <!-- Sidebar -->
    <div class="bg-dark text-white p-3 shadow-lg" style="width:250px; min-height:100vh; position:fixed; top:0; left:0; z-index:1000; margin-top:56px;">
        <h5 class="fw-bold mb-4">Menu</h5>
        <ul class="nav flex-column gap-2">
            <!-- Antrian Dropdown -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="navbarAntrian" role="button" data-bs-toggle="dropdown">
                    Antrian
                </a>
                <ul class="dropdown-menu bg-light shadow">
                    <li><a class="dropdown-item" href="{% url 'panggil_antrian' %}">Panggil Antrian</a></li>
                    <li><a class="dropdown-item" href="{% url 'buat_kegiatan_antrian' %}">Buat Kegiatan Antrian</a></li>
                    <li><a class="dropdown-item" href="{% url 'riwayat_antrian' %}">Riwayat Antrian</a></li>
                </ul>
            </li>

            <!-- Blog Link -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="navbarAntrian" role="button" data-bs-toggle="dropdown">
                    Post Berita
                </a>
                <ul class="dropdown-menu bg-light shadow">
                    <li><a class="dropdown-item" href="{% url 'create_investasi' %}">Berita Investasi</a></li>
                    
                </ul>
            </li>
           <!-- Survey Data Link -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="navbarSurvey" role="button" data-bs-toggle="dropdown">
                    Survey Data
                </a>
                <ul class="dropdown-menu bg-light shadow">
                    <li><a class="dropdown-item" href="{% url 'survey_create' %}">üìù Buat Survey</a></li>
                    <li class="dropdown-divider"></li> <!-- optional separator -->
                    <li>
                        <a class="dropdown-item" href="{% url 'staff_review_list' %}">
                            üîç Review Data
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="{% url 'staff_approve' 1 %}">
                            ‚úÖ Approve Data
                        </a>
                    </li>
                </ul>
            </li>


            <!-- Kependudukan -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="navbarSurvey" role="button" data-bs-toggle="dropdown">
                    Kependudukan
                </a>
                <ul class="dropdown-menu bg-light shadow">
                    <li><a class="dropdown-item" href="{% url 'penduduk_list' %}">Penduduk</a></li>
                    <li><a class="dropdown-item" href="{% url 'kk_list' %}">Kartu Keluarga</a></li>
                </ul>
            </li>

            <!-- Aset-->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="navbarSurvey" role="button" data-bs-toggle="dropdown">
                    Aset
                </a>
                <ul class="dropdown-menu bg-light shadow">
                    <li><a class="dropdown-item" href="{% url 'aset:aset_list' %}">Daftar Aset</a></li>
                    <li><a class="dropdown-item" href="{% url 'aset:aset_create' %}">Tambah Aset</a></li>

                </ul>
            </li>



        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content p-4" style="flex-grow:1; margin-left:250px;">
        {% if user.is_authenticated %}
            <div class="card shadow-sm border-0 p-4 mb-4">
                <h3 class="fw-bold text-success">Welcome, {{ user.username }} üéâ</h3>
                <p class="text-muted">Selamat datang di <strong>Desa Sumberoto Dashboard</strong></p>
            </div>

            <!-- Ringkasan sederhana data kependudukan -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card text-white bg-primary shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title mb-1">Total Penduduk</h6>
                            <h3 class="fw-bold mb-0">{{ total_penduduk }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-success shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title mb-1">Penduduk Hidup</h6>
                            <h3 class="fw-bold mb-0">{{ total_penduduk_hidup }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-info shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title mb-1">Laki-laki</h6>
                            <h3 class="fw-bold mb-0">{{ total_laki }}</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-danger shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title mb-1">Perempuan</h6>
                            <h3 class="fw-bold mb-0">{{ total_perempuan }}</h3>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card text-white bg-secondary shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title mb-1">Total KK</h6>
                            <h3 class="fw-bold mb-0">{{ total_kk }}</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Diagram batang distribusi umur -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">Distribusi Umur Penduduk (Hidup)</h5>
                    <canvas id="ageBarChart" height="120"></canvas>
                </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                (function() {
                    const ctx = document.getElementById('ageBarChart');
                    if (!ctx) return;

                    const labels = {{ age_labels|safe }};
                    const data = {{ age_counts|safe }};

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Jumlah Penduduk',
                                data: data,
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        precision: 0
                                    }
                                }
                            }
                        }
                    });
                })();
            </script>

        {% else %}
            <div class="alert alert-warning shadow-sm">
                Anda belum login. Silakan <a href="{% url 'user:login' %}" class="alert-link">Login</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
