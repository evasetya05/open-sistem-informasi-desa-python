{% extends "navbar.html" %}
{% load widget_tweaks %}

{% block content %}

<div class="container mt-4">
  <h2 class="mb-3 border-bottom pb-2">
    <i class="bi bi-house-door"></i> Daftar Kartu Keluarga
  </h2>

  <div class="row mb-4 align-items-center">
    <div class="col-md-4 mb-2">
      <a href="{% url 'kk_add' %}" class="btn btn-primary w-100 shadow-sm">
        <i class="bi bi-person-plus"></i> Tambah KK Baru
      </a>
    </div>

    <div class="col-md-4 mb-2">
      <form method="get" class="d-flex">
        <input type="text" name="q" class="form-control me-2" placeholder="Cari No KK atau Nama Kepala Keluarga"
               value="{{ search|default_if_none:'' }}">
        <button class="btn btn-outline-primary" type="submit">
          <i class="bi bi-search"></i> Cari
        </button>
      </form>
    </div>

    <div class="col-md-4 mb-2 text-end">
      <a href="{% url 'kk_export_xlsx' %}" class="btn btn-success w-100 shadow-sm">
        <i class="bi bi-file-earmark-excel"></i> Export XLSX
      </a>
    </div>
  </div>

  <!-- Tabel Kartu Keluarga -->
  <div class="table-responsive shadow-sm">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-primary">
        <tr>
          <th>No KK</th>
          <th>Kepala Keluarga</th>
          <th>Alamat</th>
          <th>RT</th>
          <th>RW</th>
          <th class="text-center">Aksi</th>
        </tr>
      </thead>
      <tr>
  <tbody>
  {% for kk in kks %}
  <tr>
    <td>{{ kk.no_kk }}</td>
    <td>
      {% if kk.kepala_keluarga %}
        {{ kk.kepala_keluarga.nama_lgkp }}
      {% else %}
        Belum ada
      {% endif %}
    </td>
    <td>{{ kk.kepala_keluarga.alamat|default:kk.alamat|default:"-" }}</td>
    <td>{{ kk.kepala_keluarga.no_rt|default:kk.no_rt|default:"-" }}</td>
    <td>{{ kk.kepala_keluarga.no_rw|default:kk.no_rw|default:"-" }}</td>
    <td>
      <a href="{% url 'kk_detail' kk.id %}" class="btn btn-sm btn-info">Detail</a>
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="6" class="text-center text-muted py-3">Tidak ada data KK</td>
  </tr>
  {% endfor %}
</tbody>

    </table>
  </div>

  <!-- Pagination -->
  {% if penduduks.has_other_pages %}
  <nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">

      {% if penduduks.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ penduduks.previous_page_number }}{% if search %}&q={{ search }}{% endif %}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">
          Halaman {{ penduduks.number }} dari {{ penduduks.paginator.num_pages }}
        </span>
      </li>

      {% if penduduks.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ penduduks.next_page_number }}{% if search %}&q={{ search }}{% endif %}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

</div>

<style>
  tr:hover { background-color: #f9f9f9; }
</style>

{% endblock %}
