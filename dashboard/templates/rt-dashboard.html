{% extends "navbar.html" %}

{% block title_block %}
    RT Dashboard
{% endblock title_block %}

{% block content %}
<div class="d-flex">
    <!-- Sidebar -->
    <div class="bg-dark text-white p-3 shadow-lg" style="width:250px; min-height:100vh; position:fixed; top:0; left:0; z-index:1000; margin-top:56px;">
        <h5 class="fw-bold mb-4">Menu</h5>
        <ul class="nav flex-column gap-2">
            <!-- Daftar Survey -->
            <li class="nav-item">
                <a class="nav-link text-white" href="{% url 'survey_home' %}">Daftar Survey</a>
            </li>
            <!-- Isi Survey -->
            <li class="nav-item">
                <a class="nav-link text-white" href="{% url 'response_fill' 1 %}">Isi Survey</a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content p-4" style="flex-grow:1; margin-left:250px;">
        {% if user.is_authenticated %}
            <div class="card shadow-sm border-0 p-4 mb-4">
                <h3 class="fw-bold text-success">Welcome, {{ user.username }} ðŸŽ‰</h3>
                <p class="text-muted">Berikut adalah daftar <strong>Survey Aktif</strong> yang bisa Anda isi.</p>
            </div>
        {% else %}
            <div class="alert alert-warning shadow-sm mb-4">
                Anda belum login. Silakan <a href="{% url 'user:login' %}" class="alert-link">Login</a>
            </div>
        {% endif %}

        <!-- Tabel Survey -->
        <table border="1" cellpadding="6" class="table table-striped">
            <thead>
                <tr>
                    <th>Nama Survey</th>
                    <th>Tahun</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for survey in surveys %}
                <tr>
                    <td>{{ survey.name }}</td>
                    <td>{{ survey.year }}</td>
                    <td>
                        {% with resp=survey.responses.filter(respondent=user).first %}
                            {% if resp %}
                                {{ resp.get_status_display }}
                            {% else %}
                                Belum diisi
                            {% endif %}
                        {% endwith %}
                    </td>
                    <td>
                        <a href="{% url 'response_fill' survey.id %}" class="btn btn-sm btn-primary">Isi Survey</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">Belum ada survey aktif.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
